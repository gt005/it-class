{% load static %}
<!doctype html>
<html lang="ru">
<head>
    <link rel="apple-touch-icon" sizes="57x57"
          href="{% static 'images/favicon/apple-icon-57x57.png' %}">
    <link rel="apple-touch-icon" sizes="60x60"
          href="{% static 'images/favicon/apple-icon-60x60.png' %}">
    <link rel="apple-touch-icon" sizes="72x72"
          href="{% static 'images/favicon/apple-icon-72x72.png' %}">
    <link rel="apple-touch-icon" sizes="76x76"
          href="{% static 'images/favicon/apple-icon-76x76.png' %}">
    <link rel="apple-touch-icon" sizes="114x114"
          href="{% static 'images/favicon/apple-icon-114x114.png' %}">
    <link rel="apple-touch-icon" sizes="120x120"
          href="{% static 'images/favicon/apple-icon-120x120.png' %}">
    <link rel="apple-touch-icon" sizes="144x144"
          href="{% static 'images/favicon/apple-icon-144x144.png' %}">
    <link rel="apple-touch-icon" sizes="152x152"
          href="{% static 'images/favicon/apple-icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="180x180"
          href="{% static 'images/favicon/apple-icon-180x180.png' %}">
    <link rel="icon" type="image/png" sizes="192x192"
          href="{% static 'images/favicon/android-icon-192x192.png' %}">
    <link rel="icon" type="image/png" sizes="32x32"
          href="{% static 'images/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="96x96"
          href="{% static 'images/favicon/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="16x16"
          href="{% static 'images/favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/favicon/manifest.json' %}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link href="{% static 'css/bootstrap.css' %}" rel="stylesheet"
          type="text/css">
    {% block head_links %}{% endblock %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
            integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
            integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
            crossorigin="anonymous"></script>
    <link rel="stylesheet"
          href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet"
          href="{% static 'css/tacks_education_system/style.min.css' %}">
    <title>{% block document_title %}{% endblock %} | –ò–¢-–∫–ª–∞—Å—Å –≤ —à–∫–æ–ª–µ 1158</title>
</head>

{% if not user.puples.task_education_addition_data.known_languages %}
    <div class="modal fade" id="welcome-page" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="welcome-pageLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius: 0.4em">
            <div id="welcome-page__loader" class="task-description-loader d-flex align-items-center justify-content-center"
                 style="position:absolute;height:100%;width:100%;background:rgba(255, 255, 255, 0.8);border-radius:0.4em;z-index:999;">
                <div class="spinner-border text-info"
                     role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
          <div class="modal-body">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-12">
                        <article id="welcome-page__system-description">
                            <h1 class="pt-5">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.puples.name }}!</h1>

                            <h2 class="pt-5 pb-2">–≠—Ç–æ —á—Ç–æ –≤–æ–æ–±—â–µ —Ç–∞–∫–æ–µ? üôÉ</h2>
                            <p>–î–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ —É—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è,
                                —Ä–µ—à–∞—è –∑–∞–¥–∞—á–∏ —Ä–∞–∑–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Ç–µ–º—ã. –ü–æ–≤—ã—à–∞–π —Å–≤–æ–π
                                <a href="#welcome-level-description">—É—Ä–æ–≤–µ–Ω—å</a>, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –∑–∞–¥–∞—á–∏ —Å–ª–æ–∂–Ω–µ–µ.</p>

                            <h2 class="pt-5 pb-2">–°–∏—Å—Ç–µ–º–∞ "peer to peer"</h2>
                            <p>–¢–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–≤–æ–∏ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ —Å–º–æ–≥—É—Ç —É–∫–∞–∑–∞—Ç—å –Ω–∞ –≤—Å–µ —Ç–≤–æ–∏ –æ—à–∏–±–∫–∏.
                                –ï—â–µ –Ω–∞–¥–æ –ø—Ä–∏–¥—É–º–∞—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ —Ç—É—Ç —Ö–æ—Ä–æ—à–µ–µ –∏ –∫—Ä–∞—Å–∏–≤–æ–µ(–±–æ–ª—å—à–æ–µ –ø—Ä—è–º, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç–Ω–æ –±—ã–ª–æ)</p>

                            <h2 class="pt-5 pb-2" id="welcome-level-description">–£—Ä–æ–≤–µ–Ω—å</h2>
                            <p>–£—Ä–æ–≤–µ–Ω—å - —ç—Ç–æ —Ç–≤–æ–µ –º–µ—Å—Ç–æ –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ —É—á–µ–Ω–∏–∫–æ–≤. –ü–æ–≤—ã—à–∞—è —Å–≤–æ–π —É—Ä–æ–≤–µ–Ω—å, —Ç—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—à—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ –ø—Ä–æ–µ–∫—Ç—ã.</p>
                        </article>

                        <article id="welcome-page__choose-languages" style="display: none">
                            <h1 class="pt-5">–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π –≤—ã–±–µ—Ä–µ–º —è–∑—ã–∫–∏.</h1>

                            <h2 class="pt-5 pb-2">–ó–∞—á–µ–º –∏—Ö –≤—ã–±–∏—Ä–∞—Ç—å? ü§∑‚Äç‚ôÄÔ∏è</h2>
                            <p>–°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–Ω–∞—Ç—å, –∑–∞–¥–∞—á–∏ –Ω–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—ã —Å–º–æ–∂–µ—à—å –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∑–∞–¥–∞—á–∏.</p>

                            <div id="welcome-page__choose-languages__choose-buttons" class="pt-4">
                                <div class="invalid-feedback" id="welcome-page__choose-languages__choose-buttons__empty-error">
                                    –ù—É–∂–Ω–æ –æ—Ç–º–µ—Ç–∏—Ç—å —Ö–æ—Ç—è –±—ã 1 —è–∑—ã–∫
                                </div>
                            </div>
                        </article>

                        <div id="welcome-page__end-of-welcome" style="display:none;text-align: center;">
                            <div id="man-with-crown" style="display: flex;width: 100%;justify-content: center;position: relative;padding-top: 5em;">
                                <span style="position: absolute;font-size: 56px;transform: translate(-15px, -21px) rotate(-16deg);">üëë</span>
                                <span style="font-size:120px;">üßë‚Äçüíª</span>
                            </div>
                            <h2>–ñ–µ–ª–∞–µ–º —É–¥–∞—á–∏!</h2>
                            <button type="button" class="btn btn-outline-success" data-dismiss="modal">–°–ø–∞—Å–∏–±–æ</button>
                        </div>

                    </div>
                </div>
            </div>
          </div>
          <div class="modal-footer pt-4" style="border: none">
                {% csrf_token %}
                <div id="welcome-page__system-description__buttons">
                    <button type="button" id="go-out" class="btn btn-outline-danger">–ó–∞–π–¥—É –ø–æ–∑–∂–µ...</button>
                    <button type="button" id="next-button" class="btn btn-outline-success">–î–∞–≤–∞–π –¥–∞–ª—å—à–µ</button>
                </div>

                <div id="welcome-page__choose-languages__buttons" style="display: none">
                    <button type="button" id="go-back" class="btn btn-outline-danger">–ù–∞–∑–∞–¥ –∫ –æ–ø–∏—Å–∞–Ω–∏—é</button>
                    <button type="button" id="next-button" class="btn btn-outline-success">–ü—Ä–∏—Å—Ç—É–ø–∏—Ç—å</button>
                </div>
          </div>
        </div>
      </div>
    </div>

    <script>
        $(window).on('load',function(){
            $('#welcome-page').modal('show');

            fetch(location.origin + '/tasks/set_student_settings/?getLanguagesList=true', {
                method: 'GET',
                mode: 'same-origin',  // Do not send CSRF token to another domain.
            }).then(function (response) {
                if (!response.ok) {
                    showAlertElement("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞.")
                    return false
                }

                return response.json();
            }).then(function (json) {
                console.log(json)
                if (json) {
                    let buttonsContainer = document.querySelector("#welcome-page__choose-languages__choose-buttons");

                    for (let lang of json.languages) {
                        buttonsContainer.innerHTML = `<button type="button" class="btn btn-outline-info m-1">${lang}</button>` + buttonsContainer.innerHTML
                    }

                    $('#welcome-page__choose-languages__choose-buttons button').on('click', function () {
                        this.classList.toggle('active');
                    })

                    $('#welcome-page__loader').addClass('d-none');
                    $('#welcome-page__loader').removeClass('d-flex');
                }
            });



            $('#welcome-page__system-description__buttons #go-out').on('click', function () {
                location.href = '/';
            })

            $('#welcome-page__system-description__buttons #next-button').on('click', function () {
                $('#welcome-page__system-description').hide();
                $('#welcome-page__system-description__buttons').hide();
                $('#welcome-page__choose-languages').fadeIn();
                $('#welcome-page__choose-languages__buttons').fadeIn();
                $('#welcome-page').animate({scrollTop: 0}, 300);
            })

            $('#welcome-page__choose-languages__buttons #go-back').on('click', function () {
                $('#welcome-page__choose-languages').hide();
                $('#welcome-page__choose-languages__buttons').hide();
                $('#welcome-page__choose-languages__choose-buttons__empty-error').hide();
                $('#welcome-page__system-description').fadeIn();
                $('#welcome-page__system-description__buttons').fadeIn();
                $('#welcome-page').animate({scrollTop: 0}, 300);
            })

            $('#welcome-page__choose-languages__buttons #next-button').on('click', function () {

                let activeProgrammingLanguages = $('#welcome-page__choose-languages__choose-buttons button.active'),
                    enumerateActiveProgrammingLanguages = 0;

                if (activeProgrammingLanguages.length === 0) {
                    $('#welcome-page__choose-languages__choose-buttons__empty-error').fadeIn();
                    return false;
                }

                $('#welcome-page__loader').fadeIn();
                $('#welcome-page__loader').removeClass('d-none');
                $('#welcome-page__loader').addClass('d-flex');

                let data = new FormData();

                data.append("actionSetProgrammingLanguages", 'true');

                for (let index of activeProgrammingLanguages) {
                    data.append("setProgrammingLanguage" + enumerateActiveProgrammingLanguages, activeProgrammingLanguages[enumerateActiveProgrammingLanguages].textContent);
                    enumerateActiveProgrammingLanguages++;
                }

                fetch(location.origin + '/tasks/set_student_settings/', {
                    method: 'POST',
                    mode: 'same-origin',  // Do not send CSRF token to another domain.
                    headers: {"X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value},
                    body: data
                }).then(function (response) {
                    if (!response.ok) {
                        showAlertElement("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞.")
                        return false
                    }

                    return response.json();
                }).then(function (json) {
                    console.log(json)
                if (json) {
                        $('#welcome-page__choose-languages').hide();
                        $('#welcome-page__choose-languages__buttons').hide();
                        $('#welcome-page__loader').hide();
                        $('#welcome-page__loader').addClass('d-none');
                        $('#welcome-page__loader').removeClass('d-flex');
                        $('#welcome-page__end-of-welcome').fadeIn();
                    }
                });


            })

        });
    </script>

{% endif %}

<body>

<header>
    <nav class="navbar navbar-expand-lg navbar-light">
        <a href="/" class="navbar-brand">
            <img class="img-fluid mx-3"
                 width="150" height="150"
                 src="{% static '/images/logo_it_class.svg' %}"></a>
        <button class="navbar-toggler" type="button" data-toggle="collapse"
                data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link link-navbar {% block detail_active_active_task %}{% endblock %}" href="/tasks/">–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link link-navbar notification {% block detail_active_tasks_to_check %}{% endblock %}" href="/tasks/estimate_tasks">
                        <span>–û—Ü–µ–Ω–∏—Ç—å –∑–∞–¥–∞—á–∏</span>
                        {% if tasks_amount_to_check != 0 %}
                            <span class="badge badge-pill tasks-amount-to-check">{{ tasks_amount_to_check }}</span>
                        {% endif %}
                    </a>
                </li>
                {% if user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link link-navbar {% block tasks_settings %}{% endblock %}" href="/tasks/system_settings/">
                            <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã</span>
                        </a>
                    </li>
                {% endif %}
            </ul>

            <form class="form-inline my-2 my-lg-0">
                {% if user.is_authenticated %}
                    <a class="nav-link text-dark disabled p-0"
                       href="/account/">{{ user.last_name }} {{ user.first_name }}</a>
                    <a href="/account/">
                        <img class="img-fluid mx-3 rounded-circle shadow-lg"
                             style="width: 50px; object-fit: cover; height:50px;"
                             src="{{ user.puples.image.url }}"></a>
                {% endif %}
                {% if user.username == "" %}
                    <a class="nav-link disabled" href="#">–ì–æ—Å—Ç—å</a>
                    <a class="btn btn-outline-success my-2 my-sm-0"
                       href="/login">–í–æ–π—Ç–∏</a>
                {% else %}
                    <a class="btn btn-outline-danger my-2 my-sm-0"
                       href="/logout">–í—ã–π—Ç–∏</a>
                {% endif %}
            </form>
        </div>
    </nav>
</header>

<div class="messages-container"
     style="position:fixed;width: 85%;top: 4%; left: 7.5%; z-index: 9999">
</div>

<main>
    {% block main %}{% endblock %}
</main>

<section class="modal_windows_section">
    {% block modal_windows %}{% endblock %}
</section>

<footer id="sticky-footer" class="py-4 bg-dark text-white-50 mt-5">
    <div class="container text-center">
        <small>–ì–ë–û–£ —à–∫–æ–ª–∞ ‚Ññ 1158. &copy; –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</small>
    </div>
</footer>

<script src="{% static 'js/tacks_education_system/main.js' %}"></script>
{% block scripts_include %}{% endblock %}

</body>
</html>